(function(){var initializing=false,fnTest=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){};Class.extend=function(prop){var _super=this.prototype;initializing=true;var prototype=new this();initializing=false;for(var name in prop){prototype[name]=typeof prop[name]=="function"&&typeof _super[name]=="function"&&fnTest.test(prop[name])?(function(name,fn){return function(){var tmp=this._super;this._super=_super[name];var ret=fn.apply(this,arguments);this._super=tmp;return ret}})(name,prop[name]):prop[name]}function Class(){if(!initializing&&this.init){this.init.apply(this,arguments)}}Class.prototype=prototype;Class.prototype.constructor=Class;Class.extend=arguments.callee;return Class}})();
function Config(){}function startup(){$("gameArea").parents("*").css("overflow","visible"),game=new Phaser.Game(Config.WIDTH,Config.HEIGHT,Phaser.CANVAS,"gameArea"),game.state.add("Boot",App.BootState),game.state.add("Preloader",App.PreloaderState),game.state.add("MainMenu",App.MainMenuState),game.state.add("LevelSelect",App.LevelSelectState),game.state.add("Gameplay",App.GameplayState),game.state.add("GameComplete",App.GameCompleteState),game.state.start("Boot")}Commands=function(){},Commands.prototype={gameStart:function(){Config.TEST_GAME_COMPLETE?cmd.gameComplete():cookies.isNewGame?cmd.levelStart(Config.START_LEVEL):game.state.start("LevelSelect")},levelStart:function(a){data.curLevel=data.levels[a],data.levelStartTime=game.time.now,data.pauseTime=0,game.state.start("Gameplay")},levelComplete:function(){Sounds.play("sndLevelComplete",0.5),data.curLevel.complete(data.getLevelTime()),cookies.levelComplete(),game.state.getCurrentState().levelComplete(),new LevelCompleteView},levelNext:function(){var a=data.curLevel.id;a==data.levels.length-1?cmd.gameComplete():cmd.levelStart(a+1)},gameComplete:function(){game.state.start("GameComplete")}},Config.VERSION="0.9",Config.WIDTH=640,Config.HEIGHT=712,Config.ITEM_GFX_RADIUS=30,Config.ITEM_TOUCH_RADIUS=35,Config.DRAG_BOUNDS={x:0,y:100,width:Config.WIDTH,height:Config.HEIGHT-100},Config.ANIMATION=!0,Config.SOUNDS_ENABLED=!1,Config.TRANSPARENT=!1,Config.START_LEVEL=0,Config.TEST_GAME_COMPLETE=!1,Config.SHOW_FPS=!0,Config.OPEN_ALL_LEVELS=!0,Config.RELEASE=!0,Config.RELEASE&&(Config.ANIMATION=!0,Config.SOUNDS_ENABLED=!0,Config.TRANSPARENT=!1,Config.START_LEVEL=0,Config.TEST_GAME_COMPLETE=!1,Config.SHOW_FPS=!1,Config.OPEN_ALL_LEVELS=!1);var Cookies=Class.extend({init:function(){this.gameStorageKey="dontcross_phaser",this.initSound(),this.isNewGame=!0,this.initLevels()},isSupported:function(){var a="test",b=window.sessionStorage;try{return b.setItem(a,"1"),b.removeItem(a),!0}catch(c){return !1}},getStorage:function(a){return localStorage[this.gameStorageKey+"."+a]
},setStorage:function(a,b){this.isSupported()&&(localStorage[this.gameStorageKey+"."+a]=b)},initSound:function(){Config.SOUNDS_ENABLED="false"==this.getStorage("soundEnabled")?!1:!0},saveSound:function(){this.setStorage("soundEnabled",Config.SOUNDS_ENABLED)},initLevels:function(){if(void 0!=this.getStorage("levels")){for(var a=0;a<data.levels.length;a++){var b=data.levels[a];if("true"==this.getStorage("levels."+a+".isCompleted")){b.isOpen=!0,b.isCompleted=!0;var c=this.getStorage("levels."+a+".time");void 0!==c&&(b.bestTime=parseInt(c)),this.isNewGame=!1}}}this.updateOpenLevels()},updateOpenLevels:function(){var a,b;if(Config.OPEN_ALL_LEVELS){for(a=0;a<data.levels.length;a++){b=data.levels[a],b.isOpen=!0}}else{for(a=0;a<data.levels.length;a++){if(b=data.levels[a],!b.isCompleted){b.isOpen=!0;break}}}},levelComplete:function(){this.setStorage("levels","true");var a=data.curLevel.id;this.setStorage("levels."+a+".isCompleted","true"),this.setStorage("levels."+a+".time",data.curLevel.bestTime),this.isNewGame=!1,this.updateOpenLevels()},clear:function(){localStorage.clear(),this.isNewGame=!0,this.uncompleteLevels(),this.updateOpenLevels()},uncompleteLevels:function(){for(var a=0;a<data.levels.length;a++){var b=data.levels[a];b.reset()}}});Data=Class.extend({init:function(){this.curLevel=null,this.levelStartTime=0,this.levelStartTime=0,this.pauseTime=0,this.pausedByUser=!1,this.initLevels()},initLevels:function(){this.levels=[],this.addLevel({name:"Krest",items:[{id:0,x:126,y:225},{id:1,x:126,y:533},{id:2,x:488,y:533},{id:3,x:488,y:224}],links:[{p1:3,p2:1},{p1:0,p2:2}]}),this.addLevel({name:"Snowflake",items:[{id:0,x:505,y:244},{id:1,x:156,y:568},{id:2,x:90,y:403},{id:3,x:332,y:165},{id:4,x:510,y:557},{id:5,x:566,y:400},{id:6,x:332,y:641},{id:7,x:161,y:233}],links:[{p1:0,p2:1},{p1:7,p2:4},{p1:2,p2:5},{p1:3,p2:6}]}),this.addLevel({name:"Snake",items:[{id:0,x:285,y:402},{id:1,x:285,y:619},{id:2,x:286,y:173},{id:3,x:489,y:620},{id:4,x:489,y:400},{id:5,x:131,y:506},{id:6,x:477,y:159},{id:7,x:132,y:286}],links:[{p1:0,p2:1},{p1:2,p2:0},{p1:6,p2:7},{p1:7,p2:4},{p1:5,p2:4},{p1:5,p2:3}]}),this.addLevel({name:"Two quads",items:[{id:0,x:140,y:209},{id:1,x:475,y:616},{id:2,x:475,y:416},{id:3,x:134,y:616},{id:4,x:475,y:207},{id:5,x:141,y:416}],links:[{p1:3,p2:2},{p1:5,p2:1},{p1:4,p2:5},{p1:0,p2:2},{p1:5,p2:2},{p1:0,p2:5},{p1:5,p2:3},{p1:3,p2:1},{p1:2,p2:1},{p1:4,p2:2},{p1:4,p2:0}]}),this.addLevel({name:"Straight Circle",items:[{id:0,x:497,y:226},{id:1,x:133,y:577},{id:2,x:68,y:407},{id:3,x:324,y:154},{id:4,x:504,y:582},{id:5,x:574,y:404},{id:6,x:323,y:660},{id:7,x:140,y:230}],links:[{p1:3,p2:4},{p1:2,p2:4},{p1:0,p2:2},{p1:0,p2:6},{p1:7,p2:6},{p1:7,p2:5},{p1:1,p2:5},{p1:3,p2:1}]}),this.addLevel({name:"Snowflake2",items:[{id:0,x:324,y:407},{id:1,x:497,y:226},{id:2,x:133,y:577},{id:3,x:68,y:407},{id:4,x:324,y:154},{id:5,x:504,y:582},{id:6,x:574,y:404},{id:7,x:323,y:660},{id:8,x:140,y:230}],links:[{p1:2,p2:6},{p1:8,p2:6},{p1:8,p2:7},{p1:1,p2:7},{p1:1,p2:3},{p1:3,p2:5},{p1:4,p2:5},{p1:4,p2:2},{p1:0,p2:7},{p1:4,p2:0},{p1:0,p2:6},{p1:0,p2:3}]}),this.addLevel({name:"Snowflake3",items:[{id:0,x:497,y:226},{id:1,x:133,y:577},{id:2,x:68,y:407},{id:3,x:324,y:154},{id:4,x:504,y:582},{id:5,x:574,y:404},{id:6,x:323,y:660},{id:7,x:140,y:230}],links:[{p1:0,p2:1},{p1:2,p2:5},{p1:7,p2:4},{p1:3,p2:6},{p1:3,p2:7},{p1:7,p2:2},{p1:2,p2:1},{p1:1,p2:6},{p1:6,p2:4},{p1:5,p2:4},{p1:0,p2:5}]}),this.addLevel({name:"Fixed Intro",items:[{id:0,x:460,y:549,fixed:!0},{id:1,x:194,y:549,fixed:!0},{id:2,x:460,y:281,fixed:!0},{id:3,x:194,y:281,fixed:!0},{id:4,x:326,y:407,fixed:!0},{id:5,x:68,y:407},{id:6,x:324,y:154},{id:7,x:574,y:404},{id:8,x:323,y:660}],links:[{p1:3,p2:1},{p1:2,p2:3},{p1:2,p2:0},{p1:1,p2:0},{p1:8,p2:4},{p1:6,p2:4},{p1:5,p2:4},{p1:7,p2:4}]}),this.addLevel({name:"Quad in quad",items:[{id:0,x:393,y:487},{id:1,x:237,y:488},{id:2,x:175,y:581,fixed:!0},{id:3,x:454,y:581,fixed:!0},{id:4,x:454,y:238,fixed:!0},{id:5,x:173,y:240,fixed:!0},{id:6,x:391,y:319},{id:7,x:237,y:319},{id:8,x:308,y:647,fixed:!0},{id:9,x:525,y:393,fixed:!0},{id:10,x:86,y:394,fixed:!0},{id:11,x:308,y:162,fixed:!0}],links:[{p1:6,p2:9},{p1:9,p2:0},{p1:10,p2:1},{p1:10,p2:7},{p1:6,p2:11},{p1:11,p2:7},{p1:8,p2:0},{p1:1,p2:8},{p1:7,p2:1},{p1:6,p2:7},{p1:6,p2:0},{p1:1,p2:0},{p1:2,p2:3},{p1:5,p2:2},{p1:4,p2:5},{p1:4,p2:3}]}),this.addLevel({name:"Periscope",items:[{id:0,x:571,y:536,fixed:!0},{id:1,x:488,y:493,fixed:!0},{id:2,x:405,y:533,fixed:!0},{id:3,x:323,y:552,fixed:!0},{id:4,x:240,y:536,fixed:!0},{id:5,x:157,y:499,fixed:!0},{id:6,x:75,y:538,fixed:!0},{id:7,x:454,y:670,fixed:!0},{id:8,x:373,y:671,fixed:!0},{id:9,x:371,y:309},{id:10,x:453,y:213},{id:11,x:251,y:307},{id:12,x:247,y:217},{id:13,x:174,y:378},{id:14,x:165,y:174},{id:15,x:84,y:377},{id:16,x:84,y:175},{id:17,x:653,y:545,fixed:!0},{id:18,x:-20,y:549,fixed:!0}],links:[{p1:12,p2:11},{p1:6,p2:18},{p1:6,p2:5},{p1:4,p2:5},{p1:4,p2:3},{p1:3,p2:2},{p1:1,p2:2},{p1:1,p2:0},{p1:17,p2:0},{p1:7,p2:8},{p1:10,p2:7},{p1:10,p2:12},{p1:14,p2:12},{p1:14,p2:16},{p1:16,p2:15},{p1:15,p2:13},{p1:13,p2:11},{p1:9,p2:11},{p1:9,p2:8}]}),this.addLevel({name:"Spikes",items:[{id:0,x:557,y:162,fixed:!0},{id:1,x:-28,y:576,fixed:!0},{id:2,x:464,y:576,fixed:!0},{id:3,x:307,y:470,fixed:!0},{id:4,x:676,y:471,fixed:!0},{id:5,x:461,y:162},{id:6,x:203,y:162},{id:7,x:-30,y:349,fixed:!0},{id:8,x:289,y:162},{id:9,x:375,y:162},{id:10,x:307,y:243,fixed:!0},{id:11,x:674,y:243,fixed:!0},{id:12,x:463,y:349,fixed:!0},{id:13,x:80,y:649,fixed:!0}],links:[{p1:12,p2:7},{p1:6,p2:13},{p1:6,p2:8},{p1:9,p2:8},{p1:9,p2:5},{p1:0,p2:5},{p1:4,p2:3},{p1:2,p2:1},{p1:11,p2:10}]}),this.addLevel({name:"X",items:[{id:0,x:211,y:491,fixed:!0},{id:1,x:396,y:489},{id:2,x:396,y:286,fixed:!0},{id:3,x:214,y:288},{id:4,x:296,y:374},{id:5,x:500,y:374,fixed:!0},{id:6,x:121,y:376,fixed:!0},{id:7,x:295,y:217,fixed:!0},{id:8,x:296,y:583,fixed:!0}],links:[{p1:3,p2:0},{p1:2,p2:3},{p1:2,p2:1},{p1:0,p2:1},{p1:4,p2:8},{p1:7,p2:4},{p1:6,p2:4},{p1:5,p2:4}]}),this.addLevel({name:"Line12Dots",items:[{id:0,x:599,y:450},{id:1,x:227,y:283},{id:2,x:172,y:625},{id:3,x:583,y:318},{id:4,x:544,y:559},{id:5,x:498,y:178},{id:6,x:82,y:490},{id:7,x:248,y:130},{id:8,x:298,y:428},{id:9,x:72,y:243},{id:10,x:393,y:624},{id:11,x:313,y:213}],links:[{p1:1,p2:0},{p1:2,p2:1},{p1:3,p2:2},{p1:7,p2:3},{p1:6,p2:7},{p1:6,p2:5},{p1:4,p2:5},{p1:8,p2:4},{p1:9,p2:8},{p1:9,p2:10},{p1:11,p2:10}]}),this.addLevel({name:"TwoLines",items:[{id:0,x:318,y:285},{id:1,x:109,y:570},{id:2,x:221,y:130},{id:3,x:378,y:510},{id:4,x:276,y:476},{id:5,x:602,y:142},{id:6,x:214,y:457},{id:7,x:517,y:142},{id:8,x:588,y:320},{id:9,x:464,y:464},{id:10,x:66,y:232},{id:11,x:191,y:365},{id:12,x:562,y:255},{id:13,x:146,y:674},{id:14,x:554,y:559},{id:15,x:433,y:170},{id:16,x:461,y:537},{id:17,x:276,y:597},{id:18,x:133,y:171},{id:19,x:330,y:213},{id:20,x:493,y:658},{id:21,x:55,y:429},{id:22,x:568,y:425},{id:23,x:345,y:144}],links:[{p1:0,p2:1},{p1:1,p2:2},{p1:2,p2:3},{p1:7,p2:3},{p1:7,p2:6},{p1:6,p2:5},{p1:5,p2:4},{p1:8,p2:4},{p1:9,p2:8},{p1:10,p2:9},{p1:11,p2:10},{p1:12,p2:13},{p1:14,p2:13},{p1:14,p2:15},{p1:19,p2:15},{p1:19,p2:18},{p1:17,p2:18},{p1:17,p2:16},{p1:20,p2:16},{p1:21,p2:20},{p1:21,p2:22},{p1:23,p2:22}]}),this.addLevel({name:"FourQuads",items:[{id:0,x:220,y:495},{id:1,x:175,y:208},{id:2,x:536,y:367},{id:3,x:333,y:150},{id:4,x:42,y:575},{id:5,x:513,y:190},{id:6,x:60,y:436},{id:7,x:385,y:661},{id:8,x:235,y:266},{id:9,x:508,y:469},{id:10,x:159,y:650},{id:11,x:314,y:520},{id:12,x:412,y:475},{id:13,x:434,y:320},{id:14,x:458,y:575},{id:15,x:96,y:271}],links:[{p1:7,p2:3},{p1:6,p2:2},{p1:5,p2:1},{p1:4,p2:0},{p1:0,p2:1},{p1:2,p2:3},{p1:12,p2:8},{p1:13,p2:9},{p1:14,p2:10},{p1:15,p2:11},{p1:5,p2:4},{p1:7,p2:6},{p1:10,p2:11},{p1:8,p2:9},{p1:13,p2:12},{p1:15,p2:14}]}),this.addLevel({name:"9Quads",items:[{id:0,x:125,y:206},{id:1,x:475,y:398},{id:2,x:534,y:652},{id:3,x:261,y:321},{id:4,x:498,y:292},{id:5,x:269,y:166},{id:6,x:120,y:394},{id:7,x:554,y:502},{id:8,x:129,y:533},{id:9,x:387,y:625},{id:10,x:256,y:391},{id:11,x:289,y:543},{id:12,x:306,y:642},{id:13,x:437,y:198},{id:14,x:188,y:654},{id:15,x:179,y:287}],links:[{p1:1,p2:2},{p1:11,p2:7},{p1:6,p2:5},{p1:10,p2:6},{p1:8,p2:4},{p1:9,p2:5},{p1:10,p2:9},{p1:13,p2:14},{p1:7,p2:3},{p1:6,p2:2},{p1:5,p2:1},{p1:4,p2:0},{p1:0,p2:1},{p1:2,p2:3},{p1:12,p2:8},{p1:13,p2:9},{p1:14,p2:10},{p1:15,p2:11},{p1:5,p2:4},{p1:7,p2:6},{p1:10,p2:11},{p1:8,p2:9},{p1:13,p2:12},{p1:15,p2:14}]}),this.addLevel({name:"Quad quad",items:[{id:0,x:354,y:639},{id:1,x:556,y:639},{id:2,x:554,y:453},{id:3,x:360,y:447},{id:4,x:77,y:639},{id:5,x:259,y:639},{id:6,x:268,y:450},{id:7,x:81,y:453},{id:8,x:357,y:368},{id:9,x:554,y:369},{id:10,x:559,y:182},{id:11,x:355,y:182},{id:12,x:81,y:371},{id:13,x:268,y:371},{id:14,x:264,y:184},{id:15,x:78,y:180},{id:16,x:173,y:556},{id:17,x:457,y:556},{id:18,x:457,y:272},{id:19,x:180,y:272}],links:[{p1:8,p2:6},{p1:13,p2:3},{p1:19,p2:16},{p1:16,p2:17},{p1:18,p2:17},{p1:18,p2:19},{p1:3,p2:0},{p1:0,p2:1},{p1:2,p2:1},{p1:2,p2:3},{p1:7,p2:4},{p1:4,p2:5},{p1:6,p2:5},{p1:6,p2:7},{p1:10,p2:11},{p1:10,p2:9},{p1:8,p2:9},{p1:11,p2:8},{p1:12,p2:13},{p1:14,p2:13},{p1:14,p2:15},{p1:15,p2:12}]}),this.addLevel({name:"Diagonal",items:[{id:0,x:392,y:464,fixed:!0},{id:1,x:84,y:614},{id:2,x:71,y:237},{id:3,x:399,y:649},{id:4,x:313,y:491},{id:5,x:283,y:158},{id:6,x:480,y:548,fixed:!0},{id:7,x:308,y:388,fixed:!0},{id:8,x:448,y:392},{id:9,x:243,y:660},{id:10,x:229,y:317,fixed:!0},{id:11,x:153,y:246,fixed:!0},{id:12,x:487,y:187},{id:13,x:526,y:383},{id:14,x:138,y:169},{id:15,x:30,y:461},{id:16,x:172,y:501}],links:[{p1:6,p2:2},{p1:5,p2:6},{p1:3,p2:0},{p1:9,p2:0},{p1:7,p2:4},{p1:13,p2:7},{p1:10,p2:8},{p1:14,p2:10},{p1:11,p2:12},{p1:15,p2:11},{p1:6,p2:1},{p1:0,p2:6},{p1:7,p2:0},{p1:10,p2:7},{p1:11,p2:10},{p1:16,p2:11},{p1:16,p2:12},{p1:12,p2:8},{p1:8,p2:4},{p1:4,p2:3},{p1:3,p2:2},{p1:2,p2:1},{p1:5,p2:1},{p1:9,p2:5},{p1:13,p2:9},{p1:13,p2:14},{p1:14,p2:15},{p1:15,p2:16}]}),this.addLevel({name:"Minefield",items:[{id:0,x:534,y:514},{id:1,x:452,y:207},{id:2,x:135,y:292},{id:3,x:565,y:401,fixed:!0},{id:4,x:564,y:640,fixed:!0},{id:5,x:320,y:638,fixed:!0},{id:6,x:77,y:640,fixed:!0},{id:7,x:73,y:401,fixed:!0},{id:8,x:76,y:161,fixed:!0},{id:9,x:565,y:161,fixed:!0},{id:10,x:320,y:161,fixed:!0},{id:11,x:215,y:606},{id:12,x:324,y:401,fixed:!0}],links:[{p1:1,p2:2},{p1:11,p2:2},{p1:11,p2:0},{p1:0,p2:1},{p1:1,p2:7},{p1:0,p2:7},{p1:10,p2:0},{p1:11,p2:10},{p1:11,p2:3},{p1:3,p2:2},{p1:5,p2:2},{p1:1,p2:5},{p1:1,p2:6},{p1:9,p2:11},{p1:8,p2:0},{p1:2,p2:4},{p1:12,p2:2},{p1:12,p2:1},{p1:12,p2:0},{p1:11,p2:12}]}),this.addLevel({name:"9HardQuads",items:[{id:0,x:583,y:281},{id:1,x:278,y:171},{id:2,x:49,y:540},{id:3,x:429,y:361},{id:4,x:176,y:371},{id:5,x:523,y:623},{id:6,x:511,y:461},{id:7,x:338,y:376},{id:8,x:279,y:482},{id:9,x:67,y:226},{id:10,x:443,y:269},{id:11,x:604,y:559},{id:12,x:122,y:157},{id:13,x:229,y:622},{id:14,x:270,y:303},{id:15,x:462,y:161}],links:[{p1:5,p2:0},{p1:5,p2:2},{p1:7,p2:2},{p1:10,p2:7},{p1:10,p2:5},{p1:8,p2:5},{p1:13,p2:8},{p1:13,p2:10},{p1:15,p2:10},{p1:1,p2:2},{p1:11,p2:7},{p1:6,p2:5},{p1:10,p2:6},{p1:8,p2:4},{p1:9,p2:5},{p1:10,p2:9},{p1:13,p2:14},{p1:7,p2:3},{p1:6,p2:2},{p1:5,p2:1},{p1:4,p2:0},{p1:0,p2:1},{p1:2,p2:3},{p1:12,p2:8},{p1:13,p2:9},{p1:14,p2:10},{p1:15,p2:11},{p1:5,p2:4},{p1:7,p2:6},{p1:10,p2:11},{p1:8,p2:9},{p1:13,p2:12},{p1:15,p2:14}]}),this.addLevel({name:"StaticQuad",items:[{id:0,x:495,y:292},{id:1,x:198,y:332},{id:2,x:550,y:369},{id:3,x:81,y:268},{id:4,x:506,y:544},{id:5,x:407,y:469,fixed:!0},{id:6,x:250,y:469,fixed:!0},{id:7,x:520,y:180},{id:8,x:251,y:649},{id:9,x:407,y:327,fixed:!0},{id:10,x:250,y:327,fixed:!0},{id:11,x:117,y:634},{id:12,x:89,y:500},{id:13,x:460,y:644},{id:14,x:302,y:259},{id:15,x:200,y:141}],links:[{p1:10,p2:7},{p1:6,p2:3},{p1:2,p2:5},{p1:5,p2:0},{p1:9,p2:4},{p1:12,p2:9},{p1:13,p2:10},{p1:15,p2:10},{p1:11,p2:10},{p1:6,p2:7},{p1:6,p2:2},{p1:5,p2:1},{p1:4,p2:5},{p1:9,p2:8},{p1:13,p2:9},{p1:14,p2:10},{p1:10,p2:6},{p1:6,p2:5},{p1:9,p2:5},{p1:9,p2:10},{p1:15,p2:11},{p1:11,p2:7},{p1:7,p2:3},{p1:3,p2:2},{p1:2,p2:1},{p1:1,p2:0},{p1:4,p2:0},{p1:8,p2:4},{p1:12,p2:8},{p1:12,p2:13},{p1:13,p2:14},{p1:14,p2:15}]}),this.addLevel({name:"Matreshka",items:[{id:0,x:539,y:433},{id:1,x:442,y:203},{id:2,x:93,y:395},{id:3,x:91,y:238},{id:4,x:545,y:534},{id:5,x:205,y:134},{id:6,x:77,y:647,fixed:!0},{id:7,x:547,y:130},{id:8,x:409,y:669},{id:9,x:380,y:136},{id:10,x:562,y:177,fixed:!0},{id:11,x:167,y:442},{id:12,x:437,y:339},{id:13,x:601,y:303},{id:14,x:350,y:464},{id:15,x:314,y:670},{id:16,x:260,y:512},{id:17,x:463,y:532,fixed:!0},{id:18,x:162,y:624},{id:19,x:586,y:635},{id:20,x:73,y:523},{id:21,x:180,y:289,fixed:!0},{id:22,x:258,y:441,fixed:!0},{id:23,x:228,y:215},{id:24,x:346,y:358,fixed:!0},{id:25,x:345,y:216}],links:[{p1:25,p2:22},{p1:22,p2:23},{p1:24,p2:23},{p1:24,p2:25},{p1:21,p2:14},{p1:14,p2:15},{p1:15,p2:16},{p1:16,p2:17},{p1:18,p2:17},{p1:19,p2:18},{p1:19,p2:20},{p1:20,p2:21},{p1:5,p2:6},{p1:4,p2:5},{p1:3,p2:4},{p1:13,p2:3},{p1:12,p2:13},{p1:11,p2:12},{p1:10,p2:11},{p1:10,p2:0},{p1:0,p2:1},{p1:1,p2:2},{p1:2,p2:9},{p1:8,p2:9},{p1:7,p2:8},{p1:6,p2:7}]}),this.addLevel({name:"SnakeFixed",items:[{id:0,x:355,y:389,fixed:!0},{id:1,x:-34,y:525,fixed:!0},{id:2,x:352,y:579,fixed:!0},{id:3,x:265,y:593,fixed:!0},{id:4,x:170,y:650},{id:5,x:388,y:516},{id:6,x:191,y:463},{id:7,x:367,y:657},{id:8,x:574,y:540},{id:9,x:252,y:405},{id:10,x:437,y:402},{id:11,x:273,y:135},{id:12,x:477,y:224},{id:13,x:517,y:661},{id:14,x:142,y:374},{id:15,x:240,y:197},{id:16,x:174,y:423,fixed:!0},{id:17,x:541,y:135},{id:18,x:104,y:309},{id:19,x:202,y:536},{id:20,x:50,y:392},{id:21,x:195,y:340,fixed:!0},{id:22,x:571,y:377},{id:23,x:172,y:259,fixed:!0},{id:24,x:666,y:305,fixed:!0},{id:25,x:470,y:523,fixed:!0},{id:26,x:470,y:741,fixed:!0},{id:27,x:584,y:166,fixed:!0},{id:28,x:121,y:183},{id:29,x:302,y:348},{id:30,x:48,y:645,fixed:!0}],links:[{p1:18,p2:30},{p1:18,p2:17},{p1:29,p2:17},{p1:29,p2:28},{p1:22,p2:28},{p1:15,p2:22},{p1:14,p2:15},{p1:13,p2:14},{p1:12,p2:13},{p1:11,p2:12},{p1:11,p2:10},{p1:10,p2:9},{p1:9,p2:8},{p1:7,p2:8},{p1:6,p2:7},{p1:5,p2:6},{p1:4,p2:5},{p1:4,p2:20},{p1:19,p2:20},{p1:27,p2:19},{p1:0,p2:3},{p1:25,p2:26},{p1:3,p2:2},{p1:3,p2:1},{p1:21,p2:16},{p1:23,p2:21},{p1:24,p2:23}]}),this.addLevel({name:"Grid",items:[{id:0,x:508,y:526,fixed:!0},{id:1,x:508,y:400},{id:2,x:508,y:292,fixed:!0},{id:3,x:120,y:526},{id:4,x:120,y:400,fixed:!0},{id:5,x:120,y:292},{id:6,x:200,y:599},{id:7,x:423,y:601},{id:8,x:319,y:601,fixed:!0},{id:9,x:200,y:195,fixed:!0},{id:10,x:424,y:195},{id:11,x:318,y:195}],links:[{p1:8,p2:6},{p1:8,p2:7},{p1:1,p2:0},{p1:2,p2:1},{p1:10,p2:11},{p1:9,p2:11},{p1:4,p2:3},{p1:5,p2:4},{p1:3,p2:0},{p1:4,p2:1},{p1:2,p2:5},{p1:10,p2:7},{p1:11,p2:8},{p1:9,p2:6}]}),this.addLevel({name:"Fixed X",items:[{id:0,x:315,y:493},{id:1,x:172,y:672},{id:2,x:585,y:410},{id:3,x:584,y:545},{id:4,x:503,y:486},{id:5,x:566,y:165},{id:6,x:36,y:441},{id:7,x:110,y:249},{id:8,x:559,y:295},{id:9,x:215,y:167},{id:10,x:41,y:314},{id:11,x:240,y:566},{id:12,x:569,y:632,fixed:!0},{id:13,x:69,y:630,fixed:!0},{id:14,x:68,y:163,fixed:!0},{id:15,x:573,y:158,fixed:!0},{id:16,x:320,y:148},{id:17,x:398,y:638},{id:18,x:395,y:246},{id:19,x:157,y:323},{id:20,x:321,y:399,fixed:!0},{id:21,x:195,y:515,fixed:!0},{id:22,x:447,y:516,fixed:!0},{id:23,x:448,y:279,fixed:!0},{id:24,x:195,y:282,fixed:!0}],links:[{p1:20,p2:21},{p1:21,p2:13},{p1:11,p2:17},{p1:16,p2:8},{p1:5,p2:18},{p1:19,p2:2},{p1:15,p2:23},{p1:23,p2:20},{p1:20,p2:17},{p1:20,p2:16},{p1:20,p2:5},{p1:2,p2:20},{p1:24,p2:5},{p1:5,p2:21},{p1:21,p2:16},{p1:16,p2:22},{p1:17,p2:22},{p1:23,p2:17},{p1:23,p2:2},{p1:2,p2:24},{p1:22,p2:12},{p1:20,p2:22},{p1:24,p2:20},{p1:14,p2:24},{p1:1,p2:14},{p1:1,p2:19},{p1:0,p2:19},{p1:15,p2:0},{p1:15,p2:10},{p1:10,p2:11},{p1:11,p2:9},{p1:9,p2:12},{p1:6,p2:12},{p1:8,p2:6},{p1:8,p2:7},{p1:13,p2:7},{p1:3,p2:13},{p1:18,p2:3},{p1:4,p2:18},{p1:14,p2:4}]}),this.addLevel({name:"GridFixed",items:[{id:0,x:500,y:300},{id:1,x:80,y:294},{id:2,x:449,y:158},{id:3,x:230,y:674},{id:4,x:241,y:363},{id:5,x:561,y:493},{id:6,x:536,y:671,fixed:!0},{id:7,x:320,y:733,fixed:!0},{id:8,x:539,y:601},{id:9,x:63,y:648,fixed:!0},{id:10,x:89,y:564},{id:11,x:320,y:515,fixed:!0},{id:12,x:146,y:216},{id:13,x:408,y:403},{id:14,x:576,y:195},{id:15,x:363,y:673},{id:16,x:194,y:416,fixed:!0},{id:17,x:-24,y:416,fixed:!0},{id:18,x:665,y:333,fixed:!0},{id:19,x:431,y:333,fixed:!0},{id:20,x:595,y:292},{id:21,x:62,y:468},{id:22,x:128,y:483},{id:23,x:591,y:403},{id:24,x:281,y:275,fixed:!0},{id:25,x:353,y:140},{id:26,x:543,y:156,fixed:!0},{id:27,x:366,y:483},{id:28,x:281,y:75,fixed:!0},{id:29,x:60,y:157,fixed:!0}],links:[{p1:18,p2:19},{p1:3,p2:25},{p1:3,p2:2},{p1:20,p2:3},{p1:29,p2:20},{p1:29,p2:25},{p1:25,p2:21},{p1:21,p2:2},{p1:2,p2:1},{p1:26,p2:27},{p1:26,p2:22},{p1:23,p2:22},{p1:27,p2:23},{p1:23,p2:1},{p1:22,p2:1},{p1:27,p2:1},{p1:1,p2:0},{p1:8,p2:0},{p1:12,p2:0},{p1:13,p2:0},{p1:13,p2:9},{p1:9,p2:8},{p1:12,p2:8},{p1:12,p2:13},{p1:28,p2:24},{p1:16,p2:17},{p1:11,p2:7},{p1:14,p2:0},{p1:0,p2:5},{p1:10,p2:5},{p1:15,p2:5},{p1:5,p2:4},{p1:4,p2:6},{p1:10,p2:6},{p1:14,p2:10},{p1:14,p2:15},{p1:0,p2:15}]}),this.addLevel({name:"Jail",items:[{id:0,x:568,y:521},{id:1,x:451,y:430},{id:2,x:287,y:207},{id:3,x:392,y:435,fixed:!0},{id:4,x:549,y:622,fixed:!0},{id:5,x:459,y:192},{id:6,x:567,y:417},{id:7,x:81,y:622,fixed:!0},{id:8,x:81,y:459},{id:9,x:387,y:542,fixed:!0},{id:10,x:223,y:391,fixed:!0},{id:11,x:174,y:542,fixed:!0},{id:12,x:126,y:326},{id:13,x:249,y:466},{id:14,x:415,y:663},{id:15,x:392,y:340,fixed:!0},{id:16,x:217,y:132},{id:17,x:148,y:655},{id:18,x:459,y:527},{id:19,x:392,y:258,fixed:!0},{id:20,x:577,y:313},{id:21,x:176,y:256,fixed:!0},{id:22,x:279,y:329},{id:23,x:557,y:173,fixed:!0},{id:24,x:260,y:624},{id:25,x:385,y:159},{id:26,x:81,y:173,fixed:!0}],links:[{p1:13,p2:14},{p1:13,p2:8},{p1:8,p2:4},{p1:8,p2:5},{p1:14,p2:8},{p1:18,p2:13},{p1:23,p2:18},{p1:24,p2:18},{p1:18,p2:14},{p1:2,p2:14},{p1:10,p2:1},{p1:10,p2:20},{p1:10,p2:2},{p1:16,p2:10},{p1:10,p2:0},{p1:1,p2:0},{p1:2,p2:1},{p1:20,p2:2},{p1:16,p2:20},{p1:21,p2:11},{p1:11,p2:9},{p1:3,p2:9},{p1:19,p2:15},{p1:19,p2:21},{p1:25,p2:22},{p1:12,p2:6},{p1:26,p2:22},{p1:22,p2:17},{p1:17,p2:12},{p1:12,p2:7},{p1:7,p2:6},{p1:6,p2:5},{p1:5,p2:4},{p1:13,p2:4},{p1:23,p2:13},{p1:23,p2:24},{p1:24,p2:25},{p1:25,p2:26}]})
},addLevel:function(a){var b=this.levels.length,c=new Level(b,a);this.levels.push(c)},getLevelTime:function(){return Math.round(game.time.elapsedSince(this.levelStartTime)-data.pauseTime)},getTotalTime:function(){for(var a=0,b=0;b<this.levels.length;b++){var c=this.levels[b];c.isCompleted&&(a+=c.bestTime)}return a}}),Dialog=Class.extend({init:function(a,b,c){this.game=a;var d=0,e=0,f=!1,g=!0;if(c&&(void 0!=c.x&&(d=c.x),void 0!=c.y&&(e=c.y),1==c.blockBack&&(f=!0),0==c.doTween&&(g=!1)),this.holder=new Phaser.Group(this.game,this.game.world),f&&(this.block=new Phaser.Sprite(this.game,0,0,"blackBack"),this.block.inputEnabled=!0,this.holder.add(this.block)),this.box=new Phaser.Sprite(this.game,d,e,"atlas","atlas/"+b+"_0000"),this.holder.add(this.box),g){var h=this.box.y;this.box.y=Config.HEIGHT,this.game.add.tween(this.box).to({y:h},1000,Phaser.Easing.Back.Out,!0),f&&(this.block.alpha=0,this.game.add.tween(this.block).to({alpha:1},500,Phaser.Easing.Linear.None,!0))}},destroy:function(){this.holder.destroy()}}),GameLogic=Class.extend({init:function(a){this.game=a,this.linksGroup=new Phaser.Group(this.game,this.game.world),this.linksAnimGroup=new Phaser.Group(this.game,this.game.world),this.itemsGroup=new Phaser.Group(this.game,this.game.world),this.offset={x:0,y:0},this.activeItem=null,this.intersectionsFound=void 0,this.parseLevel(data.curLevel.data),this.connectItemsWithLinks(),this.checkAllIntersections(!0),this.renderLinks(),this.renderItems(),this.linksGroup.setAll("alpha",0),this.levelAppear=new LevelAppear(this.game,this.items,this.links,this.linksAnimGroup,this.appearComplete,this),this.game.input.onDown.add(this.touchDownHandler,this)},appearComplete:function(){this.linksAnimGroup.destroy(),this.linksGroup.setAll("alpha",1),this.levelAppear=null},parseLevel:function(a){this.items=[];var b,c=a.items,d=a.links;if(a.items){for(b=0;b<c.length;b++){var e=c[b],f=e.id,g=c[b].x,h=c[b].y,i=!1;void 0!=c[b].fixed&&(i=c[b].fixed);var j=new DragItem(this.game,f,this.itemsGroup,{x:g,y:h,fixed:i});
this.items.push(j)}}if(this.links=[],a.links){for(b=0;b<d.length;b++){var k=this.getItemById(d[b].p1),l=this.getItemById(d[b].p2),m=new DragLink(this.game,this.linksGroup,k,l);this.links.push(m)}}},connectItemsWithLinks:function(){for(var a=0;a<this.items.length;a++){var b=this.items[a];b.saveLinks(this.links)}},getItemById:function(a){for(var b=0;b<this.items.length;b++){var c=this.items[b];if(c.id===a){return c}}return void 0},touchDownHandler:function(a){var b=Math.round(a.x),c=Math.round(a.y),d=this.getUnfixedItemUnderPoint(b,c);d&&(this.levelAppear&&this.appearComplete(),this.offset.x=b-d.getX(),this.offset.y=c-d.getY(),this.activeItem=d,this.activeItem.bringToTop(),this.activeItem.select(),this.game.input.onUp.add(this.touchUpHandler,this))},touchUpHandler:function(){this.game.input.onUp.remove(this.touchUpHandler,this),this.activeItem.deselect(),this.activeItem=null,this.intersectionsFound||(this.clear(),cmd.levelComplete())},clear:function(){this.game.input.onDown.remove(this.touchDownHandler,this),this.game.input.onUp.remove(this.touchUpHandler,this),this.activeItem=null},update:function(){if(this.activeItem){var a=this.game.input.activePointer,b=Math.round(a.position.x)-this.offset.x,c=Math.round(a.position.y)-this.offset.y,d=this.fitInBounds(b,c);this.activeItem.setPos(d.x,d.y),this.checkAllIntersections(!0),this.renderLinks(),this.renderItems()}},renderLinks:function(){for(var a=0;a<this.links.length;a++){var b=this.links[a];b.render()}},renderItems:function(){for(var a=this.items.length-1;a>=0;a--){var b=this.items[a];b.render()}},checkAllIntersections:function(){this.setLinksState(DragLink.STATE_NON_INTERSECT),this.intersectionsFound=!1;for(var a=0;a<this.links.length;a++){for(var b=this.links[a],c=a+1;c<this.links.length;c++){var d=this.links[c];this.linkVsLink(b,d)&&(this.intersectionsFound=!0,b.setState(DragLink.STATE_INTERSECT),d.setState(DragLink.STATE_INTERSECT))}}},setLinksState:function(a){for(var b=this.links.length-1;b>=0;b--){var c=this.links[b];
c.setState(a)}},linkVsLink:function(a,b){var c=a.p1.id,d=a.p2.id,e=b.p1.id,f=b.p2.id;if(c==e||c==f||d==e||d==f){return !1}var g=a.p1.getX(),h=a.p2.getX(),i=b.p1.getX(),j=b.p2.getX(),k=a.p1.getY(),l=a.p2.getY(),m=b.p1.getY(),n=b.p2.getY();if(Math.max(g,h)<Math.min(i,j)||Math.max(i,j)<Math.min(g,h)){return !1}if(Math.max(k,l)<Math.min(m,n)||Math.max(m,n)<Math.min(k,l)){return !1}var o=(j-i)*(k-m)-(n-m)*(g-i),p=(h-g)*(k-m)-(l-k)*(g-i),q=(n-m)*(h-g)-(j-i)*(l-k);return Math.abs(q)<0.001?!1:(o/=q,p/=q,o>0&&1>o&&p>0&&1>p?!0:!1)},fitInBounds:function(a,b){var c=Config.ITEM_GFX_RADIUS,d=Config.DRAG_BOUNDS.x,e=Config.DRAG_BOUNDS.y,f=Config.DRAG_BOUNDS.width,g=Config.DRAG_BOUNDS.height;return d+c>a&&(a=d+c),a>d+f-c&&(a=d+f-c),e+c>b&&(b=e+c),b>e+g-c&&(b=e+g-c),{x:a,y:b}},getUnfixedItemUnderPoint:function(a,b){for(var c=Config.ITEM_TOUCH_RADIUS,d=void 0,e=0;e<this.items.length;e++){var f=this.items[e];if(!f.fixed){var g=a-f.getX(),h=b-f.getY(),i=Math.sqrt(g*g+h*h);c>=i&&(c=i,d=f)}}return d}}),Level=Class.extend({init:function(a,b){this.id=a,this.data=b,this.reset()},reset:function(){this.isCompleted=!1,this.isOpen=!1,this.bestTime=5940000,this.lastTime=-1},complete:function(a){this.isCompleted=!0,this.lastTime=1000*Math.floor(a/1000),this.lastTime<this.bestTime&&(this.bestTime=this.lastTime)},getTitle:function(){return this.data.name}});var game,cmd,data,cookies,fader;Sounds=function(){},Sounds.startMusic=function(){Config.SOUNDS_ENABLED&&(Sounds.musicChannel=game.add.audio("music",1,!0),Sounds.musicChannel.play())},Sounds.stopMusic=function(){Sounds.musicChannel.pause()},Sounds.play=function(a,b){var c=1;void 0!=b&&(c=b),Config.SOUNDS_ENABLED&&game.sound.play(a,c)};var texts={TUTORIAL1:"Lines are crossed.\nThey shouldn't be.",TUTORIAL2:"Touch and drag these dots\nto uncross the lines.",LEVEL:"Level ",TAPS:"Taps: ",GAME_BY:"Game by Eugene Karataev",MUSIC_BY:"Music by Kevin MacLeod"},Util=function(){};Util.pulse=function(a,b){a.add.tween(b.scale).to({x:1.2,y:1.2},1000,Phaser.Easing.Sinusoidal.InOut).to({x:1,y:1},1000,Phaser.Easing.Sinusoidal.InOut).loop().start()
},Util.formatTime=function(a){var b=Math.floor(a/1000),c=Math.floor(b/3600),d=Math.floor((b-3600*c)/60),e=b-3600*c-60*d;return 10>c&&(c="0"+c),10>d&&(d="0"+d),10>e&&(e="0"+e),d+":"+e},Util.addAtlasSprite=function(a,b){var c=0,d=0;return b&&(void 0!=b.x&&(c=b.x),void 0!=b.y&&(d=b.y)),game.add.sprite(c,d,"atlas","atlas/"+a+"_0000")},CreditsView=Dialog.extend({init:function(a){this._super(a,"creditsBox",{x:60,y:60,blockBack:!0}),this.closeBt=new MyButton(this.game,"closeButton",this.closeClick,this,{x:507,y:40,center:!0,parent:this.box,atlas:!0}),this.logoBt=new MyButton(this.game,"postepennoLogo",this.logoClick,this,{x:120,y:104,parent:this.box,atlas:!0}),this.gameByTxt=new Phaser.Text(this.game,260,470,"Game by Eugene Karataev",{font:"bold 38px Arial"}),this.gameByTxt.anchor.set(0.5,0),this.box.addChild(this.gameByTxt),this.emailTxt=new Phaser.Text(this.game,260,520,"eugene.karataev@gmail.com",{font:"bold 34px Arial"}),this.emailTxt.anchor.set(0.5,0),this.box.addChild(this.emailTxt)},closeClick:function(){this.destroy()},logoClick:function(){window.open("http://postepenno.com","_blank")}}),DeleteProgressView=Dialog.extend({init:function(){this._super(game,"clearProgressBox",{x:100,y:150,blockBack:!0}),this.yesBt=new MyButton(this.game,"yesButton",this.yesClick,this,{x:120,y:210,center:!0,parent:this.box,atlas:!0}),this.noBt=new MyButton(this.game,"noButton",this.noClick,this,{x:320,y:210,center:!0,parent:this.box,atlas:!0})},yesClick:function(){cookies.clear(),this.destroy()},noClick:function(){this.destroy()}}),DragItem=Class.extend({init:function(a,b,c,d){this.game=a,this.id=b,this.parentGroup=c;var e=0,f=0;this.fixed=!1,d&&(void 0!=d.x&&(e=d.x),void 0!=d.y&&(f=d.y),void 0!=d.fixed&&(this.fixed=d.fixed)),this.g=new Phaser.Graphics(this.game,0,0),this.parentGroup.add(this.g),this.g.x=e,this.g.y=f},bringToTop:function(){this.parentGroup.bringToTop(this.g)},saveLinks:function(a){this.links=[];for(var b=0;b<a.length;b++){var c=a[b];(c.p1.id===this.id||c.p2.id===this.id)&&this.links.push(c)
}},getLinks:function(){return this.links},render:function(){var a="0xFFFFFF",b=10;if(this.fixed){a="0x000000",b=10}else{b=Config.ITEM_GFX_RADIUS;for(var c=!1,d=!1,e=0;e<this.links.length;e++){var f=this.links[e];f.getState()===DragLink.STATE_NON_INTERSECT?c=!0:f.getState()===DragLink.STATE_INTERSECT&&(d=!0)}c?a=d?"0xFED138":"0x569D01":d&&(a="0xAE0001")}this.g.clear(),this.g.beginFill(a),this.g.drawCircle(0,0,b),this.g.endFill()},getX:function(){return this.g.x},getY:function(){return this.g.y},setPos:function(a,b){this.g.x=a,this.g.y=b},select:function(){this.g.scale.x=this.g.scale.y=1,this.t1&&this.t1.stop(),this.t2&&this.t2.stop(),this.t1=new Phaser.Tween(this.g.scale,this.game,this.game.tweens),this.t2=new Phaser.Tween(this.g.scale,this.game,this.game.tweens),this.t1.to({x:1.2,y:1.2},150,Phaser.Easing.Sinusoidal.InOut),this.t2.to({x:1,y:1},150,Phaser.Easing.Sinusoidal.InOut),this.t1.chain(this.t2),this.t2.chain(this.t1),this.t1.start()},deselect:function(){this.t1&&this.t1.stop(),this.t2&&this.t2.stop(),this.g.scale.x=this.g.scale.y=1}}),DragLink=Class.extend({init:function(a,b,c,d){this.game=a,this.parentGroup=b,this.p1=c,this.p2=d,this.setState(DragLink.STATE_NON_INTERSECT),this.g=new Phaser.Graphics(this.game,0,0),this.parentGroup.add(this.g)},render:function(){this.g.clear(),this.g.lineStyle(5,this.color),this.g.moveTo(this.p1.getX(),this.p1.getY()),this.g.lineTo(this.p2.getX(),this.p2.getY())},setState:function(a){this.state=a,this.color=DragLink.getColorByState(this.state)},getState:function(){return this.state}}),DragLink.STATE_INTERSECT="StateIntersect",DragLink.STATE_NON_INTERSECT="StateNonIntersect",DragLink.STATE_UNKNOWN="StateUnknown",DragLink.getColorByState=function(a){return a==DragLink.STATE_INTERSECT?"0xAE0001":a==DragLink.STATE_NON_INTERSECT?"0x569D01":a==DragLink.STATE_UNKNOWN?"0xA5A5A5":void 0},FPS=function(a){this.game=a,this.game.time.advancedTiming=!0,this.init()},FPS.prototype.init=function(){this.fpsTxt=new Phaser.Text(this.game,0,Config.HEIGHT-20,"FPS: XXX",{font:"bold 20px Arial",fill:"#FF0000"}),this.game.add.existing(this.fpsTxt),this.update(),this.game.time.events.loop(Phaser.Timer.SECOND,this.update,this)
},FPS.prototype.update=function(){this.fpsTxt.setText("FPS: "+this.game.time.fps)},Fader=Class.extend({init:function(a){this.game=a},fade:function(a,b){this.callback=a,this.scope=b,this.pic=game.add.sprite(0,0,"fader"),this.pic.alpha=0,this.pic.inputEnabled=!0;var c=game.add.tween(this.pic).to({alpha:0.8},300,Phaser.Easing.Linear.None,!0);c.onComplete.addOnce(this.fadeInComplete,this)},fadeInComplete:function(){Fader.SHOULD_FADE_OUT=!0,this.callback.call(this.scope)},fadeOut:function(){Fader.SHOULD_FADE_OUT=!1,this.pic=game.add.sprite(0,0,"fader"),this.pic.inputEnabled=!0;var a=game.add.tween(this.pic).to({alpha:0},300,Phaser.Easing.Linear.None,!0);a.onComplete.addOnce(this.fadeOutComplete,this)},fadeOutComplete:function(){this.pic.destroy()}}),Fader.SHOULD_FADE_OUT=!1,LevelAppear=Class.extend({init:function(a,b,c,d,e,f){this.game=a,this.items=b,this.links=c,this.linksGroup=d,this.callback=e,this.callbackContext=f,this.totalTime=1000+20*this.items.length;var g,h=(this.totalTime-LevelAppear.ITEM_TIME)/this.items.length,i=(this.totalTime-LevelAppear.LINK_TIME)/this.links.length;for(g=0;g<this.items.length;g++){this.tweenItem(g*h,this.items[g])}for(this.linkAnims=[],g=0;g<this.links.length;g++){var j=new LinkAnim(this.game,g*i,d,this.links[g]);this.linkAnims.push(j)}var k={a:10},l=this.game.add.tween(k).to({a:20},this.totalTime,Phaser.Easing.Linear.None,!0);l.onComplete.addOnce(this.complete,this)},complete:function(){this.callback.call(this.callbackContext)},tweenItem:function(a,b){b.g.scale.x=b.g.scale.y=0,this.game.add.tween(b.g.scale).delay(a).to({x:1,y:1},LevelAppear.ITEM_TIME,Phaser.Easing.Back.Out,!0)}}),LevelAppear.ITEM_TIME=800,LevelAppear.LINK_TIME=800,LevelCompleteView=Dialog.extend({init:function(){this._super(game,"levelCompleteBox",{x:100,y:400}),this.nextButton=new MyButton(this.game,"nextButton",this.nextClick,this,{x:220,y:180,center:!0,parent:this.box,atlas:!0})},nextClick:function(){cmd.levelNext()}}),LevelItem=Class.extend({init:function(a,b,c,d,e){if(this.game=a,this.level=c,this.parentGroup=b,this.group=new Phaser.Group(this.game,this.parentGroup),this.group.x=d,this.group.y=e,c.isOpen){var f,g="#000000";
c.isCompleted?(f="levelItemCompleteBack",g="#39541D"):(f="levelItemBack",g="#212A56"),this.bt=new MyButton(this.game,f,this.click,this,{center:!0,parent:this.group,atlas:!0});var h=new Phaser.Text(this.game,0,0,(this.level.id+1).toString(),{font:"50px Arial",fill:g});h.anchor.set(0.5,0.5),this.group.add(h)}else{var i=Util.addAtlasSprite("levelItemLockedBack",{x:0,y:0});i.anchor.set(0.5,0.5),this.group.add(i)}if(c.isOpen&&c.isCompleted){var j=Util.formatTime(this.level.bestTime),k=new Phaser.Text(this.game,0,25,j,{font:"16px Arial",fill:g});k.anchor.set(0.5,0),this.group.add(k)}},click:function(){fader.fade(this.go,this)},go:function(){cmd.levelStart(this.level.id)}}),LevelsGroup=Class.extend({init:function(a,b,c){this.game=a,this.id=b,this.parentGroup=c,this.group=new Phaser.Group(this.game,this.parentGroup),this.group.y=this.id*Config.HEIGHT;for(var d=9,e=3,f=160,g=160,h=(Config.WIDTH-f*(e-1))/2,i=200,j=this.id*d,k=(this.id+1)*d,l=0,m=j;k>m;m++){var n=data.levels[m];if(n){var o=h+l%e*f,p=i+Math.floor(l/e)*g;new LevelItem(this.game,this.group,n,o,p)}l++}}}),LinkAnim=Class.extend({init:function(a,b,c,d){this.game=a,this.delay=b,this.parentGroup=c,this.link=d,this.color=DragLink.getColorByState(d.state),this.g=new Phaser.Graphics(this.game,0,0),this.parentGroup.add(this.g),this.g.clear(),this.g.lineStyle(5,this.color);var e=this.link.p1.getX(),f=this.link.p1.getY(),g=this.link.p2.getX(),h=this.link.p2.getY(),i=g-e,j=h-f,k=Math.floor(Math.sqrt(i*i+j*j));this.g.x=e+i/2,this.g.y=f+j/2,this.g.moveTo(-k/2,0),this.g.lineTo(k/2,0),this.g.rotation=Math.atan2(j,i),this.g.scale.x=0,this.game.add.tween(this.g.scale).delay(this.delay).to({x:1},LevelAppear.LINK_TIME,Phaser.Easing.Cubic.Out,!0)},destroy:function(){this.g.destroy()}}),MyButton=function(a,b,c,d,e){var f=0,g=0,h=!1,i=void 0,j=!1;if(e&&(void 0!=e.x&&(f=e.x),void 0!=e.y&&(g=e.y),1==e.center&&(h=!0),void 0!=e.parent&&(i=e.parent),1==e.atlas&&(j=!0)),j){var k="atlas/"+b+"_0000";Phaser.Button.call(this,a,f,g,"atlas",c,d,k,k,k,k)
}else{Phaser.Button.call(this,a,f,g,b,c,d)}void 0!=i?i.addChild(this):a.add.existing(this),this.input.useHandCursor=!0,h&&this.anchor.set(0.5,0.5)},MyButton.prototype=Object.create(Phaser.Button.prototype),MyButton.prototype.constructor=MyButton,MyButton.prototype.onInputDownHandler=function(){Sounds.play("sndClick")},MyButton.prototype.scaleHide=function(){this.game.add.tween(this.scale).to({x:0,y:0},200,Phaser.Easing.Linear.None,!0)},MyButton.prototype.scaleShow=function(){this.game.add.tween(this.scale).to({x:1,y:1},200,Phaser.Easing.Linear.None,!0)},MyButton.prototype.hide=function(){this.scale.x=this.scale.y=0},MyButton.prototype.show=function(){this.scale.x=this.scale.y=1},MyButton.prototype.disableClick=function(){this.inputEnabled=!1},MyButton.prototype.enableClick=function(){this.inputEnabled=!0},NewRecord=Class.extend({init:function(a){this.game=a,this.startX=180,this.startY=20,this.group=new Phaser.Group(this.game,this.game.world),this.pic=Util.addAtlasSprite("newRecord",{x:this.startX,y:this.startY}),this.group.add(this.pic),this.pic.alpha=0,this.game.add.tween(this.pic).to({alpha:1},500,Phaser.Easing.Linear.None,!0),this.game.add.tween(this.pic).to({x:this.startX+10},800,Phaser.Easing.Sinusoidal.InOut).to({x:this.startX},800,Phaser.Easing.Sinusoidal.InOut).loop().start()}}),PauseView=Dialog.extend({init:function(a){this.parentState=a,this._super(game,"pauseBox",{x:100,y:200,blockBack:!0}),this.exitBt=new MyButton(this.game,"levelsButton",this.exitClick,this,{x:130,y:210,center:!0,parent:this.box,atlas:!0}),this.nextBt=new MyButton(this.game,"nextButton",this.resumeClick,this,{x:310,y:210,center:!0,parent:this.box,atlas:!0}),this.startTime=game.time.now,data.pausedByUser=!0},exitClick:function(){fader.fade(this.gotoMenu,this)},gotoMenu:function(){game.state.start("LevelSelect")},resumeClick:function(){data.pausedByUser=!1,data.pauseTime+=Math.round(game.time.now-this.startTime),this.parentState.resumeGame(),this.destroy()}}),SoundIcon=function(a,b){Phaser.Group.call(this,a,void 0,"sndIcon"),a.add.existing(this);
var c=0,d=0,e=1;void 0!=b&&(void 0!=b.x&&(c=b.x),void 0!=b.y&&(d=b.y),void 0!=b.scale&&(e=b.scale)),this.x=c,this.y=d,this.scale.x=this.scale.y=e;var f="atlas/soundIconOn_0000",g="atlas/soundIconOff_0000";this.btOn=new Phaser.Button(this.game,0,0,"atlas",this.sndClick,this,f,f,f,f),this.add(this.btOn),this.btOff=new Phaser.Button(this.game,0,0,"atlas",this.sndClick,this,g,g,g,g),this.add(this.btOff),this.btOn.anchor.set(0.5,0.5),this.btOff.anchor.set(0.5,0.5),this.updateIcon()},SoundIcon.prototype=Object.create(Phaser.Group.prototype),SoundIcon.prototype.constructor=SoundIcon,SoundIcon.prototype.updateIcon=function(){Config.SOUNDS_ENABLED?(this.btOn.visible=!0,this.btOff.visible=!1):(this.btOn.visible=!1,this.btOff.visible=!0)},SoundIcon.prototype.sndClick=function(){Config.SOUNDS_ENABLED=!Config.SOUNDS_ENABLED,Config.SOUNDS_ENABLED?Sounds.startMusic():Sounds.stopMusic(),cookies.saveSound(),this.updateIcon()},Timer=Class.extend({init:function(a,b){this.game=a;var c=0,d=0;b&&(void 0!=b.x&&(c=b.x),void 0!=b.y&&(d=b.y)),this.group=new Phaser.Group(this.game,this.game.world),this.group.x=c,this.group.y=d,this.icon=new Util.addAtlasSprite("timerIcon",{x:45,y:50}),this.icon.anchor.set(0.5,0.5),this.group.add(this.icon);var e=Util.formatTime(0);this.timeTf=new Phaser.Text(this.game,140,30,e,{font:"37px Arial"}),this.timeTf.anchor.set(0.5,0),this.group.add(this.timeTf)},setTime:function(a){var b=Util.formatTime(a);this.timeTf.setText(b)}}),Tutorial=Class.extend({init:function(a){this.game=a,0==data.curLevel.id&&(this.addText(texts.TUTORIAL1,110,500),this.addText(texts.TUTORIAL2,600,2000))},addText:function(a,b,c){var d=this.game.add.text(Config.WIDTH/2,b,a,{font:"34px Arial",fill:"#000000"});d.align="center",d.anchor.set(0.5,0),d.alpha=0,d.y-=10,this.game.add.tween(d).delay(c).to({alpha:1,y:b},1000,Phaser.Easing.Quadratic.Out,!0)}});var App={};App.BootState=function(){},App.BootState.prototype={preload:function(){this.load.image("preloadBar","assets/images/preloadBar.png"),this.load.image("preloadBarHolder","assets/images/preloadBarHolder.png"),this.load.image("background","assets/images/background.png"),game.stage.backgroundColor="#EBE7DA"
},create:function(){this.game.input.maxPointers=1,this.game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.game.scale.pageAlignHorizontally=!0,this.game.scale.pageAlignVertically=!0,this.game.scale.enterPortrait.add(this.rescale,this),this.game.scale.enterLandscape.add(this.rescale,this),this.game.scale.setScreenSize(!0),Config.TRANSPARENT&&(this.game.world.alpha=0.5),this.game.state.start("Preloader")},rescale:function(){var a=this.game;setTimeout(function(){a.scale.refresh()},500)}},App.GameCompleteState=function(){},App.GameCompleteState.prototype={create:function(){this.add.sprite(0,0,"background"),this.dialog=new Dialog(this.game,"gameCompleteBox",{x:60,y:60,blockBack:!1}),this.homeBt=new MyButton(this.game,"homeButton",this.exitClick,this,{x:260,y:500,center:!0,parent:this.dialog.box,atlas:!0})},exitClick:function(){fader.fade(this.gotoMenu,this)},gotoMenu:function(){this.game.state.start("LevelSelect")}},App.GameplayState=function(){},App.GameplayState.prototype={create:function(){this.add.sprite(0,0,"background"),Util.addAtlasSprite("levelUIBack",{x:0,y:0}),this.restartBt=new MyButton(this.game,"restartButton",this.restartClick,this,{x:480,y:50,center:!0,atlas:!0}),this.pauseBt=new MyButton(this.game,"pauseButton",this.pauseClick,this,{x:590,y:50,center:!0,atlas:!0}),this.soundIcon=new SoundIcon(this.game,{x:370,y:50});var a=data.curLevel.id+1,b=new Phaser.Text(this.game,Config.WIDTH/2,Config.HEIGHT/2+35,a,{font:"500px Arial",fill:"#FFFFFF"});b.anchor.set(0.5,0.5),this.add.existing(b),this.timer=new Timer(this.game),this.tutorial=new Tutorial(this.game),this.logic=new GameLogic(this.game),this.addTimerEvent(),this.game.onPause.add(this.globalPauseOn,this),this.game.onResume.add(this.globalPauseOff,this),Config.SHOW_FPS&&(this.fps=new FPS(this.game)),Fader.SHOULD_FADE_OUT&&fader.fadeOut()},globalPauseOn:function(){this.globalPauseStart=game.time.now},globalPauseOff:function(){data.pausedByUser||(data.pauseTime+=Math.round(game.time.now-this.globalPauseStart))
},addTimerEvent:function(){this.timerEvent=this.game.time.events.loop(Phaser.Timer.SECOND,this.updateUI,this)},removeTimerEvent:function(){this.game.time.events.remove(this.timerEvent)},updateUI:function(){this.timer.setTime(data.getLevelTime())},levelComplete:function(){if(this.removeTimerEvent(),data.curLevel.lastTime==data.curLevel.bestTime){new NewRecord(this.game)}},update:function(){this.logic.update()},restartClick:function(){cmd.levelStart(data.curLevel.id)},pauseClick:function(){this.removeTimerEvent(),this.pauseView=new PauseView(this)},resumeGame:function(){this.addTimerEvent()}},App.LevelSelectState=function(){},App.LevelSelectState.prototype={create:function(){this.add.sprite(0,0,"background"),this.itemsHolder=new Phaser.Group(this.game,this.game.world);for(var a=0;3>a;a++){new LevelsGroup(this.game,a,this.itemsHolder)}Util.addAtlasSprite("levelSelectTitle",{x:112,y:10}),this.homeBt=new MyButton(this.game,"homeButton",this.homeClick,this,{x:70,y:650,center:!0,atlas:!0}),this.scrollUp=new MyButton(this.game,"upButton",this.scrollUpClick,this,{x:570,y:650,center:!0,atlas:!0}),this.scrollDown=new MyButton(this.game,"downButton",this.scrollDownClick,this,{x:450,y:650,center:!0,atlas:!0}),this.timer=new Timer(this.game,{x:170,y:600}),this.timer.setTime(data.getTotalTime()),this.itemsHolder.y=-Config.HEIGHT*App.LevelSelectState.CURRENT_GROUP_ID,0==App.LevelSelectState.CURRENT_GROUP_ID?this.scrollUp.hide():2==App.LevelSelectState.CURRENT_GROUP_ID&&this.scrollDown.hide(),Fader.SHOULD_FADE_OUT&&fader.fadeOut()},scrollUpClick:function(){1==App.LevelSelectState.CURRENT_GROUP_ID?this.scrollUp.scaleHide():2==App.LevelSelectState.CURRENT_GROUP_ID&&this.scrollDown.scaleShow(),App.LevelSelectState.CURRENT_GROUP_ID--,this.scrollUp.disableClick(),this.scrollDown.disableClick();var a=this.game.add.tween(this.itemsHolder);a.to({y:-Config.HEIGHT*App.LevelSelectState.CURRENT_GROUP_ID},500,Phaser.Easing.Quadratic.InOut,!0),a.onComplete.addOnce(this.scrollComplete,this)},scrollDownClick:function(){0==App.LevelSelectState.CURRENT_GROUP_ID?this.scrollUp.scaleShow():1==App.LevelSelectState.CURRENT_GROUP_ID&&this.scrollDown.scaleHide(),App.LevelSelectState.CURRENT_GROUP_ID++,this.scrollUp.disableClick(),this.scrollDown.disableClick();
var a=this.game.add.tween(this.itemsHolder);a.to({y:-Config.HEIGHT*App.LevelSelectState.CURRENT_GROUP_ID},500,Phaser.Easing.Quadratic.InOut,!0),a.onComplete.addOnce(this.scrollComplete,this)},scrollComplete:function(){this.scrollUp.enableClick(),this.scrollDown.enableClick()},homeClick:function(){fader.fade(this.gotoMainMenu,this)},gotoMainMenu:function(){this.game.state.start("MainMenu")}},App.LevelSelectState.CURRENT_GROUP_ID=0,App.MainMenuState=function(){},App.MainMenuState.prototype={create:function(){this.add.sprite(0,0,"background"),this.title=Util.addAtlasSprite("gameTitle",{x:150,y:30}),this.playBt=new MyButton(this.game,"playButton2",this.playClick,this,{x:320,y:620,center:!0,atlas:!0}),Util.pulse(this,this.playBt),this.soundIcon=new SoundIcon(this.game,{x:580,y:60}),this.deleteProgressBt=new MyButton(this.game,"restartButton",this.deleteProgressClick,this,{x:580,y:640,center:!0,atlas:!0}),this.creditsBt=new MyButton(this.game,"creditsButton",this.creditsClick,this,{x:60,y:640,center:!0,atlas:!0});var a="v "+Config.VERSION;this.add.text(2,0,a,{font:"10px Arial",fill:"#000000"}),Config.SHOW_FPS&&(this.fps=new FPS(this.game)),Config.RELEASE||this.add.text(10,10,"DEVELOPMENT VERSION",{font:"30px Arial",fill:"#FF0000"}),this.showWithTweens(),Fader.SHOULD_FADE_OUT&&fader.fadeOut()},showWithTweens:function(){this.title.alpha=0,this.add.tween(this.title).to({alpha:1},800,Phaser.Easing.Linear.None,!0),this.tweenScaleButton(this.soundIcon,800),this.tweenScaleButton(this.creditsBt,1000),this.tweenScaleButton(this.deleteProgressBt,1200),this.tweenAlphaButton(this.playBt,1500)},tweenScaleButton:function(a,b){a.scale.x=a.scale.y=0,this.add.tween(a.scale).to({x:1,y:1},500,Phaser.Easing.Back.Out,!0,b)},tweenAlphaButton:function(a,b){a.alpha=0,this.add.tween(a).to({alpha:1},500,Phaser.Easing.Linear.None,!0,b)},playClick:function(){fader.fade(this.startGame,this)},startGame:function(){cmd.gameStart()},deleteProgressClick:function(){new DeleteProgressView(this.game)},creditsClick:function(){new CreditsView(this.game)
}},App.PreloaderState=function(){},App.PreloaderState.prototype={preload:function(){this.add.sprite(0,0,"background");var a,b=["background","fader","blackBack"],c=["sndClick","sndLevelComplete","music"];for(a=0;a<b.length;a++){var d=-1==b[a].indexOf(".jpg")?b[a]+".png":b[a];this.load.image(b[a],"assets/images/"+d)}for(a=0;a<c.length;a++){var e=c[a]+".mp3",f=c[a]+".ogg";this.load.audio(c[a],["assets/sounds/"+e,"assets/sounds/"+f])}this.load.atlasJSONHash("atlas","assets/images/atlas.png","assets/images/atlas.json"),this.holder=this.game.add.group(),this.add.sprite(120,280,"preloadBarHolder",null,this.holder),this.preloadBar=this.add.sprite(127,287,"preloadBar",null,this.holder),this.progressTxt=this.game.add.text(Config.WIDTH/2,200,"0%",{font:"bold 50px Arial",fill:"#000000"},this.holder),this.progressTxt.anchor.set(0.5,0),this.load.setPreloadSprite(this.preloadBar),this.load.onFileComplete.add(this.fileLoaded,this)},fileLoaded:function(a){this.progressTxt.setText(a+"%")},create:function(){var a=this.game.add.tween(this.holder).to({alpha:0,y:this.holder.y+60},800,Phaser.Easing.Linear.None,!0);a.onComplete.addOnce(this.preloaderComplete,this)},preloaderComplete:function(){fader=new Fader(this.game),cmd=new Commands,data=new Data,data.init(),cookies=new Cookies,Sounds.startMusic(),this.game.state.start("MainMenu")}};
